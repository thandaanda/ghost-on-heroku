#!/usr/bin/env node

var mysql      = require('mysql');
var envValues  = require('./common/env-values');
var fs = require('fs');
console.error(`Awaiting MySQL databaseâ€¦`);
fs.appendFileSync('deletepost.txt', 'delete post called');
deletePosts();

function deletePosts() {
  var connection = mysql.createConnection(envValues.mysqlDatabaseUrl);
  connection.query("SELECT 1", function (error, results, fields) {
    if (error) {
      fs.appendFileSync('deletepost.txt', 'Error in delete post');
      console.error(`Database not yet available: ${error.message}`);
    } else {
      connection.query("DELETE FROM posts", function (error, results, fields) {
        fs.appendFileSync('deletepost.txt', 'posts deleted');
        fs.appendFileSync('deletepost.txt', JSON.stringify(error));
        fs.appendFileSync('deletepost.txt', JSON.stringify(results));
        fs.appendFileSync('deletepost.txt', JSON.stringify(fields));
        console.error("posts deleted.");
        connection.end();
        process.exit(0);
      });
    }
  });
}


